{"ast":null,"code":"/*\r\n    Copyright 2018 The caver-js Authors\r\n    This file is part of the caver-js library.\r\n\r\n    The caver-js library is free software: you can redistribute it and/or modify\r\n    it under the terms of the GNU Lesser General Public License as published by\r\n    the Free Software Foundation, either version 3 of the License, or\r\n    (at your option) any later version.\r\n\r\n    The caver-js library is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n    GNU Lesser General Public License for more details.\r\n\r\n    You should have received a copy of the GNU Lesser General Public License\r\n    along with the caver-js. If not, see <http://www.gnu.org/licenses/>.\r\n*/\nconst {\n  last\n} = require('lodash');\n\nconst builtinsMiddleware = require('./builtins');\n\nfunction Middleware() {\n  this.list = [];\n}\n/**\r\n * getMiddlewares return `this.list` from Middleware instance.\r\n * @return {Array} `this.list`\r\n */\n\n\nMiddleware.prototype.getMiddlewares = function () {\n  return this.list;\n};\n/**\r\n * registerMiddleware - add middleware function to `this.list`\r\n * @param  {function} middleware function to be registered.\r\n */\n\n\nMiddleware.prototype.registerMiddleware = function (middleware) {\n  if (typeof middleware !== 'function') throw Error('Middleware should be a function');\n  this.list.push(middleware);\n};\n\nMiddleware.prototype.applyMiddleware = function (data, type, sendRequest) {\n  // Tags `type` property to check whether middleware is consumed from outbound or not.\n  // If consumed as outbound, It tags `data` as 'request'\n  // Otherwise, It tags `data` as 'response'\n  data.type = type === 'outbound' ? 'request' : 'response'; // inbound\n  // For outbound middleware, it must have RPC send function as last middleware.\n\n  handleMiddleware(sendRequest ? // `RPC send` is concatenated as a last middleware.\n  this.list.concat(sendRequest) : // last middleware is not a `RPC send`.\n  [...this.list], // `bypass` function is only available for outbound middleware\n  data.type === 'request' && sendRequest)(data);\n};\n\nfunction handleMiddleware(list, bypass) {\n  return function recur(data, next) {\n    // When there are no more item in `this.list`,\n    // it means all middleware function has been consumed.\n    if (list.length === 0) return; // When the argument is put into `next()` function,\n    // The `data` argument get changed in next middleware, taking it as first argument `data`.\n\n    if (arguments.length === 2 && typeof next !== 'function') data = next; // Shift first item from `this.list`, consuming it as a middleware function.\n\n    const fn = list.shift(); // Consuming middleware function,\n    // It would be used outerspace as `caver.use(data, next, bypass)`.\n\n    fn(data, recur.bind(null, data), function _bypass() {\n      // `_bypass` function only works when `bypass` value is true.\n      if (!bypass) return; // When the argument is put into `bypass()` function,\n      // The `data` arugment get changed in next middleware which is last one, request manager,\n      // taking it as first argument `data`.\n\n      if (arguments.length !== 0) data = arguments[0]; // `_bypass` function skips all middleware list except last one.\n\n      list = [last(list)];\n      recur(data);\n    });\n  };\n} // Generate `Middleware` instance, it would be exported as a *singleton*.\n\n\nconst middleware = new Middleware();\nmodule.exports = middleware;\nmodule.exports.builtin = builtinsMiddleware;","map":{"version":3,"names":["last","require","builtinsMiddleware","Middleware","list","prototype","getMiddlewares","registerMiddleware","middleware","Error","push","applyMiddleware","data","type","sendRequest","handleMiddleware","concat","bypass","recur","next","length","arguments","fn","shift","bind","_bypass","module","exports","builtin"],"sources":["C:/Users/User/Documents/clone-starter-kit-08/node_modules/caver-js/packages/caver-middleware/src/index.js"],"sourcesContent":["/*\r\n    Copyright 2018 The caver-js Authors\r\n    This file is part of the caver-js library.\r\n\r\n    The caver-js library is free software: you can redistribute it and/or modify\r\n    it under the terms of the GNU Lesser General Public License as published by\r\n    the Free Software Foundation, either version 3 of the License, or\r\n    (at your option) any later version.\r\n\r\n    The caver-js library is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n    GNU Lesser General Public License for more details.\r\n\r\n    You should have received a copy of the GNU Lesser General Public License\r\n    along with the caver-js. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nconst { last } = require('lodash')\r\nconst builtinsMiddleware = require('./builtins')\r\n\r\nfunction Middleware() {\r\n    this.list = []\r\n}\r\n\r\n/**\r\n * getMiddlewares return `this.list` from Middleware instance.\r\n * @return {Array} `this.list`\r\n */\r\nMiddleware.prototype.getMiddlewares = function() {\r\n    return this.list\r\n}\r\n\r\n/**\r\n * registerMiddleware - add middleware function to `this.list`\r\n * @param  {function} middleware function to be registered.\r\n */\r\nMiddleware.prototype.registerMiddleware = function(middleware) {\r\n    if (typeof middleware !== 'function') throw Error('Middleware should be a function')\r\n    this.list.push(middleware)\r\n}\r\n\r\nMiddleware.prototype.applyMiddleware = function(data, type, sendRequest) {\r\n    // Tags `type` property to check whether middleware is consumed from outbound or not.\r\n    // If consumed as outbound, It tags `data` as 'request'\r\n    // Otherwise, It tags `data` as 'response'\r\n    data.type = type === 'outbound' ? 'request' : 'response' // inbound\r\n\r\n    // For outbound middleware, it must have RPC send function as last middleware.\r\n    handleMiddleware(\r\n        sendRequest\r\n            ? // `RPC send` is concatenated as a last middleware.\r\n              this.list.concat(sendRequest)\r\n            : // last middleware is not a `RPC send`.\r\n              [...this.list],\r\n        // `bypass` function is only available for outbound middleware\r\n        data.type === 'request' && sendRequest\r\n    )(data)\r\n}\r\n\r\nfunction handleMiddleware(list, bypass) {\r\n    return function recur(data, next) {\r\n        // When there are no more item in `this.list`,\r\n        // it means all middleware function has been consumed.\r\n        if (list.length === 0) return\r\n\r\n        // When the argument is put into `next()` function,\r\n        // The `data` argument get changed in next middleware, taking it as first argument `data`.\r\n        if (arguments.length === 2 && typeof next !== 'function') data = next\r\n\r\n        // Shift first item from `this.list`, consuming it as a middleware function.\r\n        const fn = list.shift()\r\n\r\n        // Consuming middleware function,\r\n        // It would be used outerspace as `caver.use(data, next, bypass)`.\r\n        fn(data, recur.bind(null, data), function _bypass() {\r\n            // `_bypass` function only works when `bypass` value is true.\r\n            if (!bypass) return\r\n\r\n            // When the argument is put into `bypass()` function,\r\n            // The `data` arugment get changed in next middleware which is last one, request manager,\r\n            // taking it as first argument `data`.\r\n            if (arguments.length !== 0) data = arguments[0]\r\n\r\n            // `_bypass` function skips all middleware list except last one.\r\n            list = [last(list)]\r\n            recur(data)\r\n        })\r\n    }\r\n}\r\n\r\n// Generate `Middleware` instance, it would be exported as a *singleton*.\r\nconst middleware = new Middleware()\r\n\r\nmodule.exports = middleware\r\nmodule.exports.builtin = builtinsMiddleware\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,MAAM;EAAEA;AAAF,IAAWC,OAAO,CAAC,QAAD,CAAxB;;AACA,MAAMC,kBAAkB,GAAGD,OAAO,CAAC,YAAD,CAAlC;;AAEA,SAASE,UAAT,GAAsB;EAClB,KAAKC,IAAL,GAAY,EAAZ;AACH;AAED;AACA;AACA;AACA;;;AACAD,UAAU,CAACE,SAAX,CAAqBC,cAArB,GAAsC,YAAW;EAC7C,OAAO,KAAKF,IAAZ;AACH,CAFD;AAIA;AACA;AACA;AACA;;;AACAD,UAAU,CAACE,SAAX,CAAqBE,kBAArB,GAA0C,UAASC,UAAT,EAAqB;EAC3D,IAAI,OAAOA,UAAP,KAAsB,UAA1B,EAAsC,MAAMC,KAAK,CAAC,iCAAD,CAAX;EACtC,KAAKL,IAAL,CAAUM,IAAV,CAAeF,UAAf;AACH,CAHD;;AAKAL,UAAU,CAACE,SAAX,CAAqBM,eAArB,GAAuC,UAASC,IAAT,EAAeC,IAAf,EAAqBC,WAArB,EAAkC;EACrE;EACA;EACA;EACAF,IAAI,CAACC,IAAL,GAAYA,IAAI,KAAK,UAAT,GAAsB,SAAtB,GAAkC,UAA9C,CAJqE,CAIZ;EAEzD;;EACAE,gBAAgB,CACZD,WAAW,GACL;EACA,KAAKV,IAAL,CAAUY,MAAV,CAAiBF,WAAjB,CAFK,GAGL;EACA,CAAC,GAAG,KAAKV,IAAT,CALM,EAMZ;EACAQ,IAAI,CAACC,IAAL,KAAc,SAAd,IAA2BC,WAPf,CAAhB,CAQEF,IARF;AASH,CAhBD;;AAkBA,SAASG,gBAAT,CAA0BX,IAA1B,EAAgCa,MAAhC,EAAwC;EACpC,OAAO,SAASC,KAAT,CAAeN,IAAf,EAAqBO,IAArB,EAA2B;IAC9B;IACA;IACA,IAAIf,IAAI,CAACgB,MAAL,KAAgB,CAApB,EAAuB,OAHO,CAK9B;IACA;;IACA,IAAIC,SAAS,CAACD,MAAV,KAAqB,CAArB,IAA0B,OAAOD,IAAP,KAAgB,UAA9C,EAA0DP,IAAI,GAAGO,IAAP,CAP5B,CAS9B;;IACA,MAAMG,EAAE,GAAGlB,IAAI,CAACmB,KAAL,EAAX,CAV8B,CAY9B;IACA;;IACAD,EAAE,CAACV,IAAD,EAAOM,KAAK,CAACM,IAAN,CAAW,IAAX,EAAiBZ,IAAjB,CAAP,EAA+B,SAASa,OAAT,GAAmB;MAChD;MACA,IAAI,CAACR,MAAL,EAAa,OAFmC,CAIhD;MACA;MACA;;MACA,IAAII,SAAS,CAACD,MAAV,KAAqB,CAAzB,EAA4BR,IAAI,GAAGS,SAAS,CAAC,CAAD,CAAhB,CAPoB,CAShD;;MACAjB,IAAI,GAAG,CAACJ,IAAI,CAACI,IAAD,CAAL,CAAP;MACAc,KAAK,CAACN,IAAD,CAAL;IACH,CAZC,CAAF;EAaH,CA3BD;AA4BH,C,CAED;;;AACA,MAAMJ,UAAU,GAAG,IAAIL,UAAJ,EAAnB;AAEAuB,MAAM,CAACC,OAAP,GAAiBnB,UAAjB;AACAkB,MAAM,CAACC,OAAP,CAAeC,OAAf,GAAyB1B,kBAAzB"},"metadata":{},"sourceType":"script"}